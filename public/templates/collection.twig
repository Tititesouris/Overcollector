{% import "cosmetic.twig" as cosmeticMacro %}
{% extends "page.twig" %}
{% block body %}
    {% set itemsPerRow = 3 %}
    {% set allCosmetics = SESSION.cosmetics %}
    <!--suppress HtmlUnknownTarget -->
    <div class="mdl-grid">
        <div id="cosmetics-menu" class="mdl-cell mdl-cell--3-col">
            <ul class="demo-list-icon mdl-list mdl-shadow--2dp">
                <li class="cosmetics-menu--update mdl-list__item">
                    <span class="mdl-list__item-primary-content">
                        <button class="cosmetics-menu--update-save mdl-button mdl-js-button mdl-button--raised mdl-button--colored">Save</button>
                        <button class="cosmetics-menu--update-cancel mdl-button mdl-js-button mdl-button--raised mdl-button--colored" disabled>Cancel</button>
                    </span>
                </li>
                <li class="mdl-list__item">
                    <span class="mdl-list__item-primary-content mdl-typography--font-bold">
                        Show Owned
                    </span>
                    <span class="mdl-list__item-secondary-action">
                        <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-show-owned">
                            <input type="checkbox" id="switch-show-owned" class="setting-input mdl-switch__input"
                                   data-setting="collection-show-owned-cosmetics" {{ SESSION.user.settings["collection-show-owned-cosmetics"].value ?? true ? "checked" }}>
                        </label>
                    </span>
                </li>
                <hr/>
                <li class="cosmetics-menu--toggle mdl-list__item">
                    <span class="mdl-list__item-primary-content mdl-typography--font-bold">
                        Categories
                    </span>
                    <span class="mdl-list__item-secondary-action">
                        <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-all-categories">
                            <input type="checkbox" id="switch-all-categories" class="setting-input mdl-switch__input"
                                   data-setting="collection-show-categories" {{ SESSION.user.settings["collection-show-categories"].value ?? true ? "checked" }}>
                        </label>
                    </span>
                </li>
                <li class="cosmetics-menu--item cosmetics-menu--item-category mdl-list__item">
                        <span class="cosmetics-menu--item--image mdl-list__item-primary-content">
                            <img src="img/collection/categories/default.png"/>Default
                        </span>
                    <span class="mdl-list__item-secondary-action">
                        <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="category-checkbox-default">
                            <input type="checkbox" id="category-checkbox-default" class="setting-input mdl-checkbox__input"
                                   data-setting="collection-show-category-default" {{ SESSION.user.settings["collection-show-category-default"].value ?? true ? "checked" }}/>
                        </label>
                    </span>
                </li>
                {% for category in SESSION.categories %}
                    <li class="cosmetics-menu--item cosmetics-menu--item-category mdl-list__item">
                        <span class="cosmetics-menu--item--image mdl-list__item-primary-content">
                            <img src="img/collection/categories/{{ category.short }}.png"/>{{ category.name }}
                        </span>
                        <span class="mdl-list__item-secondary-action">
                            <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect"
                                   for="category-checkbox-{{ category.short }}">
                                <input type="checkbox" id="category-checkbox-{{ category.short }}"
                                       class="setting-input mdl-checkbox__input"
                                       data-setting="collection-show-category-{{ category.short }}"
                                        {{ SESSION.user.settings["collection-show-category-" ~ category.short].value ?? true ? "checked" }}/>
                            </label>
                        </span>
                    </li>
                {% endfor %}
                <hr/>
                <li class="cosmetics-menu--toggle mdl-list__item">
                    <span class="mdl-list__item-primary-content mdl-typography--font-bold">
                        Heroes
                    </span>
                    <span class="mdl-list__item-secondary-action">
                        <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-all-heroes">
                            <input type="checkbox" id="switch-all-heroes" class="setting-input mdl-switch__input"
                                   data-setting="collection-show-heroes" {{ SESSION.user.settings["collection-show-heroes"].value ?? true ? "checked" }}>
                        </label>
                    </span>
                </li>
                <li class="cosmetics-menu--item cosmetics-menu--item-hero mdl-list__item">
                        <span class="cosmetics-menu--item--image mdl-list__item-primary-content">
                            <img src="img/collection/heroes/allheroes.png"/>All Heroes
                        </span>
                    <span class="mdl-list__item-secondary-action">
                        <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="hero-checkbox-allheroes">
                            <input type="checkbox" id="hero-checkbox-allheroes" class="setting-input mdl-checkbox__input"
                                   data-setting="collection-show-hero-allheroes" {{ SESSION.user.settings["collection-show-hero-allheroes"].value ?? true ? "checked" }}/>
                        </label>
                    </span>
                </li>
                {% for hero in SESSION.heroes %}
                    <li class="cosmetics-menu--item cosmetics-menu--item-hero mdl-list__item">
                        <span class="cosmetics-menu--item--image mdl-list__item-primary-content">
                            <img src="img/collection/heroes/{{ hero.short }}.png"/>{{ hero.name }}
                        </span>
                        <span class="mdl-list__item-secondary-action">
                            <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect"
                                   for="hero-checkbox-{{ hero.short }}">
                                <input type="checkbox" id="hero-checkbox-{{ hero.short }}"
                                       class="setting-input mdl-checkbox__input"
                                       data-setting="collection-show-hero-{{ hero.short }}"
                                        {{ SESSION.user.settings["collection-show-hero-" ~ hero.short].value ?? true ? "checked" }}/>
                            </label>
                        </span>
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div class="mdl-cell mdl-cell--9-col-desktop">
            <table id="cosmetics-table" class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
                {% for hero, types in allCosmetics %}
                    {% set ownedCosmetics = SESSION.user.getCosmetics(hero) %}
                    {% set totalOwned, totalCosmetics = 0, 0 %}
                    {% for owned in ownedCosmetics %}
                        {% set totalOwned = totalOwned + owned|length %}
                    {% endfor %}
                    {% for cosmetics in allCosmetics[hero] %}
                        {% set totalCosmetics = totalCosmetics + cosmetics|length %}
                    {% endfor %}
                    <tbody class="cosmetics-table--body hero-{{ hero > 0 ? SESSION.heroes[hero].id : 0 }}">
                    {% set ratio = totalOwned / totalCosmetics %}
                    <tr class="cosmetics-table--hero" style="background-color: {{ ratio|colorgradient("rgba") }};">
                        <td colspan="{{ itemsPerRow - 1 }}"
                            class="mdl-typography--headline mdl-data-table__cell--non-numeric">
                            {{ hero > 0 ? SESSION.heroes[hero].name : "All Heroes" }}
                        </td>
                        <td>
                            {{ (ratio * 100)|round(2, 'floor') }}%
                            ({{ totalOwned }} / {{ totalCosmetics }})
                        </td>
                    </tr>
                    {% for type, cosmetics in types %}
                        {% set ratio = (ownedCosmetics[type] is defined ? ownedCosmetics[type]|length : 0) / allCosmetics[hero][type]|length %}
                        <tr class="cosmetics-table--type" style="background-color: {{ ratio|colorgradient("rgba") }};">
                            <td colspan="{{ itemsPerRow - 1 }}">{{ SESSION.types[type].name }}s</td>
                            <td>
                                {{ (ratio * 100)|round(2, 'floor') }}%
                                ({{ ownedCosmetics[type] is defined ? ownedCosmetics[type]|length : 0 }}
                                / {{ allCosmetics[hero][type]|length }})
                            </td>
                        </tr>
                        {% for cosmetic in cosmetics %}
                            {% if loop.index0 % itemsPerRow == 0 %}
                                <tr>
                            {% endif %}
                            <td class="cosmetics-table--category category-{{ cosmetic.category is not null ? cosmetic.category.id : 0 }}">
                                {{ cosmeticMacro.cosmetic(cosmetic, SESSION.user.hasCosmetic(cosmetic.id)) }}
                            </td>
                            {% if loop.index0 % itemsPerRow == (itemsPerRow - 1) or loop.index == loop.length %}
                                </tr>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                    </tbody>
                {% endfor %}
            </table>
        </div>
    </div>

{% endblock %}